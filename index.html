<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‰¾æ­æ¾¤äºå¤©æ›¸åŠ©æ‰‹ - æ©Ÿç‡è¨ˆç®—å™¨</title>
    <style>
        :root {
            --paper-bg: #f8f1e5;
            --paper-dark: #e6d5b8;
            --ink: #3d2b1f;
            --gold: #b8860b;
            --line-1: #3182ce;
            --line-2: #38a169;
            --line-3: #e53e3e;
            --cell-bg: #ffffff;
            --cell-active: #5d4037;
        }

        body {
            background-color: #121212;
            background-image: radial-gradient(#2c2c2c 1px, transparent 1px);
            background-size: 20px 20px;
            font-family: "PingFang TC", "Microsoft JhengHei", "Noto Sans TC", sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px;
            color: var(--ink);
        }

        .container {
            background: var(--paper-bg);
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.5)),
                url('https://www.transparenttextures.com/patterns/parchment.png');
            width: 100%;
            max-width: 480px;
            padding: 40px 30px;
            border-radius: 4px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8), inset 0 0 100px rgba(184, 134, 11, 0.1);
            border: 1px solid #d4c4a8;
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: "";
            position: absolute;
            top: 10px; left: 10px; right: 10px; bottom: 10px;
            border: 2px solid var(--gold);
            opacity: 0.3;
            pointer-events: none;
        }

        h1 {
            text-align: center;
            margin: 0;
            font-size: 24px;
            color: #4a3728;
            letter-spacing: 2px;
        }

        .subtitle {
            text-align: center;
            font-size: 12px;
            color: #8c7a6b;
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 14px;
            font-weight: 600;
        }

        .reset-btn {
            background: #5d4037;
            color: #f8f1e5;
            border: none;
            padding: 6px 14px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
        }

        .reset-btn:hover {
            background: #3e2723;
            transform: translateY(-1px);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            background: rgba(0,0,0,0.05);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 25px;
        }

        .cell {
            aspect-ratio: 1;
            background: var(--cell-bg);
            border: 1px solid #dcd0bc;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }

        .cell:hover {
            background: #fffaf0;
            border-color: var(--gold);
        }

        .cell.selected {
            background: var(--cell-active);
            color: #ffd700;
            border-color: #3e2723;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transform: scale(0.95);
        }

        .cell.selected::after {
            content: "â˜…";
            filter: drop-shadow(0 0 2px rgba(255,215,0,0.5));
        }

        .suggestion-card {
            background: rgba(255, 255, 255, 0.7);
            border-left: 4px solid var(--gold);
            padding: 15px;
            border-radius: 0 6px 6px 0;
            margin-bottom: 25px;
            font-size: 14px;
            line-height: 1.6;
            animation: fadeIn 0.4s ease-out;
        }

        .suggestion-card.perfect { border-color: #d69e2e; background: #fffaf0; }
        .suggestion-card.good { border-color: var(--line-2); background: #f0fff4; }
        .suggestion-card.bad { border-color: var(--line-3); background: #fff5f5; }

        .result-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .prob-item {
            background: rgba(255,255,255,0.4);
            padding: 10px;
            border-radius: 6px;
        }

        .prob-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 14px;
            font-weight: 700;
        }

        .prob-details {
            font-size: 11px;
            color: #8c7a6b;
            font-weight: normal;
            margin-left: 5px;
        }

        .progress-container {
            height: 6px;
            background: rgba(0,0,0,0.05);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            transition: width 0.6s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }

        .bar-0 { background: #a0aec0; }
        .bar-1 { background: var(--line-1); }
        .bar-2 { background: var(--line-2); }
        .bar-3 { background: var(--line-3); }

        .placeholder-text {
            text-align: center;
            color: #8c7a6b;
            padding: 40px 0;
            font-style: italic;
            font-size: 14px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        hr { border: 0; border-top: 1px solid rgba(0,0,0,0.08); margin: 20px 0; }
    </style>
</head>
<body>

<div class="container">
    <h1>åº«æ´›å¤©æ›¸æ©Ÿç‡è¨ˆç®—</h1>
    <div class="subtitle">Khloe's Wondrous Tails Helper</div>

    <div class="info-bar">
        <div>å·²æ¨™è¨˜è²¼ç´™: <span id="sticker-count">0</span> / 7</div>
        <button class="reset-btn" onclick="resetGrid()">é‡è¨­æ£‹ç›¤</button>
    </div>

    <div class="grid" id="grid">
        <!-- Cells generated by JS -->
    </div>

    <div id="suggestion-area"></div>

    <div id="results-area">
        <div class="placeholder-text">è«‹åœ¨ä¸Šæ–¹æ£‹ç›¤æ¨™è¨˜ 7 æšè²¼ç´™çš„ä½ç½®</div>
    </div>
</div>

<script>
    const gridEl = document.getElementById('grid');
    const countEl = document.getElementById('sticker-count');
    const suggestionEl = document.getElementById('suggestion-area');
    const resultsEl = document.getElementById('results-area');

    let selectedCells = [];
    
    const winningLines = [
        [0, 1, 2, 3], [4, 5, 6, 7], [8, 9, 10, 11], [12, 13, 14, 15], 
        [0, 4, 8, 12], [1, 5, 9, 13], [2, 6, 10, 14], [3, 7, 11, 15], 
        [0, 5, 10, 15], [3, 6, 9, 12]                                
    ];

    function init() {
        for (let i = 0; i < 16; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.dataset.index = i;
            cell.addEventListener('click', () => toggleCell(i));
            gridEl.appendChild(cell);
        }
    }

    function toggleCell(index) {
        const idx = selectedCells.indexOf(index);
        if (idx > -1) {
            selectedCells.splice(idx, 1);
        } else {
            if (selectedCells.length < 7) {
                selectedCells.push(index);
            }
        }
        updateUI();
    }

    function resetGrid() {
        selectedCells = [];
        updateUI();
    }

    function updateUI() {
        const cells = document.querySelectorAll('.cell');
        cells.forEach((cell, i) => {
            cell.classList.toggle('selected', selectedCells.includes(i));
        });

        countEl.innerText = selectedCells.length;

        if (selectedCells.length === 7) {
            calculateProbabilities();
        } else {
            suggestionEl.innerHTML = '';
            resultsEl.innerHTML = `<div class="placeholder-text">é‚„éœ€è¦æ¨™è¨˜ ${7 - selectedCells.length} å€‹è²¼ç´™ä½ç½®</div>`;
        }
    }

    function calculateProbabilities() {
        let remainingIndices = [];
        for (let i = 0; i < 16; i++) {
            if (!selectedCells.includes(i)) remainingIndices.push(i);
        }

        let comboCounts = { 0: 0, 1: 0, 2: 0, 3: 0 };
        
        for (let i = 0; i < remainingIndices.length; i++) {
            for (let j = i + 1; j < remainingIndices.length; j++) {
                const finalSet = new Set([...selectedCells, remainingIndices[i], remainingIndices[j]]);
                let lines = 0;
                
                winningLines.forEach(line => {
                    if (line.every(pos => finalSet.has(pos))) {
                        lines++;
                    }
                });
                
                comboCounts[Math.min(lines, 3)]++;
            }
        }

        renderResults(comboCounts);
    }

    function renderResults(counts) {
        const total = 36;
        const p0 = (counts[0] / total * 100).toFixed(1);
        const p1 = (counts[1] / total * 100).toFixed(1);
        const p2 = (counts[2] / total * 100).toFixed(1);
        const p3 = (counts[3] / total * 100).toFixed(1);
        
        const p1plusRaw = counts[1] + counts[2] + counts[3];
        const p2plusRaw = counts[2] + counts[3];
        
        const p1plus = (p1plusRaw / total * 100).toFixed(1);
        const p2plus = (p2plusRaw / total * 100).toFixed(1);

        let adv = "", cls = "";
        if (parseFloat(p3) > 0) {
            adv = `ğŸŒŸ <strong>ç™¼ç¾ 3 ç·šé››å½¢ï¼</strong> ç›®å‰æœ‰ ${p3}% çš„æ©Ÿç‡é€£æˆ 3 ç·šï¼ˆé‡‘ç¥¨ï¼‰ã€‚é€™åœ¨æ•¸å­¸ä¸Šæ˜¯éå¸¸ç½•è¦‹çš„å¼·å‹¢é™£å‹ï¼Œå¼·çƒˆå»ºè­°ç›´æ¥é–‹çï¼`;
            cls = "perfect";
        } else if (parseFloat(p2plus) >= 20) {
            adv = `âœ… <strong>é™£å‹éå¸¸ç©©å¥ï¼š</strong> è‡³å°‘ 2 ç·šçš„æ©Ÿç‡é«˜é” ${p2plus}%ã€‚é€™å·²ç¶“æ˜¯å¾ˆå„ªè³ªçš„çµæœï¼Œè‹¥éåŸ·è‘—é‡‘ç¥¨ï¼Œä¸å»ºè­°å†æ¶ˆè€—é»æ•¸ã€Œé‡æ–°è²¼ã€ã€‚`;
            cls = "good";
        } else if (parseFloat(p1plus) >= 50) {
            adv = `ğŸ’¡ <strong>ä½æ¨™æ©Ÿç‡å°šå¯ï¼š</strong> è‡³å°‘æœ‰ ${p1plus}% çš„æ©Ÿæœƒæ‹¿åˆ° 1 ç·šã€‚è‹¥çå‹µé»æ•¸å‰©é¤˜ä¸å¤šï¼Œå¯ä»¥è€ƒæ…®æ”¶æ‰‹ã€‚`;
            cls = "";
        } else {
            adv = `âš ï¸ <strong>å»ºè­°ã€Œé‡æ–°è²¼ã€ï¼š</strong> ç›®å‰é™£å‹ä¸å¯èƒ½é”æˆ 3 ç·šï¼Œä¸”é€£ 1 ç·šçš„æ©Ÿç‡éƒ½ä½æ–¼ä¸€åŠã€‚è‹¥æœ‰é»æ•¸ï¼Œå»ºè­°é‡æ´—ä½ç½®ã€‚`;
            cls = "bad";
        }

        suggestionEl.innerHTML = `<div class="suggestion-card ${cls}">${adv}</div>`;

        resultsEl.innerHTML = `
            <div class="result-section">
                <div class="prob-item">
                    <div class="prob-header"><span>0 ç·š (æ§“é¾œ)</span><span>${p0}%</span></div>
                    <div class="progress-container"><div class="progress-bar bar-0" style="width: ${p0}%"></div></div>
                </div>
                <div class="prob-item">
                    <div class="prob-header">
                        <span>è‡³å°‘ 1 ç·š (1+)</span>
                        <span>${p1plus}% <span class="prob-details">(${p1}% + ${p2plus}%)</span></span>
                    </div>
                    <div class="progress-container"><div class="progress-bar bar-1" style="width: ${p1plus}%"></div></div>
                </div>
                <div class="prob-item">
                    <div class="prob-header">
                        <span>è‡³å°‘ 2 ç·š (2+)</span>
                        <span>${p2plus}% <span class="prob-details">(${p2}% + ${p3}%)</span></span>
                    </div>
                    <div class="progress-container"><div class="progress-bar bar-2" style="width: ${p2plus}%"></div></div>
                </div>
                <div class="prob-item">
                    <div class="prob-header"><span>æ°å¥½ 3 ç·š (é‡‘ç¥¨)</span><span>${p3}%</span></div>
                    <div class="progress-container"><div class="progress-bar bar-3" style="width: ${p3}%"></div></div>
                </div>
            </div>
        `;
    }

    init();
</script>
</body>
</html>
